# å›½ç½‘é£æ§æ•°ä»“ - æ•°æ®è§‚å¯ŸæŒ‡å—

## ğŸ“Š æ•°æ®æµç›‘æ§é‡ç‚¹è¡¨

### ğŸ” Source æ•°æ®åº“ç›‘æ§ (postgres-sgcc-source:5442)

#### æ ¸å¿ƒä¸šåŠ¡è¡¨ - é‡ç‚¹å…³æ³¨æ•°æ®å˜åŒ–

1. **è®¾å¤‡ä¿¡æ¯è¡¨ (equipment_info)**
   ```sql
   -- æŸ¥çœ‹è®¾å¤‡æ€»æ•°å’ŒçŠ¶æ€åˆ†å¸ƒ
   SELECT status, COUNT(*) as count FROM equipment_info GROUP BY status;
   
   -- æŸ¥çœ‹æœ€è¿‘æ›´æ–°çš„è®¾å¤‡
   SELECT * FROM equipment_info ORDER BY updated_at DESC LIMIT 10;
   ```

2. **å®¢æˆ·ä¿¡æ¯è¡¨ (customer_info)**
   ```sql
   -- æŸ¥çœ‹å®¢æˆ·ç±»å‹åˆ†å¸ƒ
   SELECT customer_type, COUNT(*) as count FROM customer_info GROUP BY customer_type;
   
   -- æŸ¥çœ‹æ´»è·ƒå®¢æˆ·æ•°
   SELECT status, COUNT(*) as count FROM customer_info GROUP BY status;
   ```

3. **ç”¨ç”µæ•°æ®è¡¨ (power_consumption)** â­ **æœ€é‡è¦**
   ```sql
   -- æŸ¥çœ‹å®æ—¶ç”¨ç”µæ•°æ®ï¼ˆæœ€è¿‘1å°æ—¶ï¼‰
   SELECT customer_id, equipment_id, active_power, reactive_power, record_time 
   FROM power_consumption 
   WHERE record_time >= NOW() - INTERVAL '1 hour' 
   ORDER BY record_time DESC LIMIT 20;
   
   -- æŸ¥çœ‹æ•°æ®å¢é•¿é€Ÿåº¦
   SELECT COUNT(*) as total_records, 
          MAX(record_time) as latest_time,
          MIN(record_time) as earliest_time
   FROM power_consumption;
   ```

4. **è®¾å¤‡çŠ¶æ€è¡¨ (equipment_status)** â­ **é‡è¦**
   ```sql
   -- æŸ¥çœ‹è®¾å¤‡å¥åº·çŠ¶æ€
   SELECT equipment_id, operating_status, health_score, risk_level, status_time
   FROM equipment_status 
   WHERE status_time >= NOW() - INTERVAL '1 hour'
   ORDER BY status_time DESC;
   
   -- æŸ¥çœ‹å¼‚å¸¸è®¾å¤‡
   SELECT * FROM equipment_status 
   WHERE operating_status != 'RUNNING' OR health_score < 70
   ORDER BY status_time DESC;
   ```

5. **å‘Šè­¦è®°å½•è¡¨ (alert_records)** â­ **é‡è¦**
   ```sql
   -- æŸ¥çœ‹æœ€æ–°å‘Šè­¦
   SELECT alert_type, alert_level, alert_title, equipment_id, alert_time, status
   FROM alert_records 
   WHERE alert_time >= NOW() - INTERVAL '1 hour'
   ORDER BY alert_time DESC;
   
   -- æŸ¥çœ‹æœªè§£å†³å‘Šè­¦
   SELECT COUNT(*) as open_alerts, alert_level
   FROM alert_records 
   WHERE status IN ('OPEN', 'ACKNOWLEDGED')
   GROUP BY alert_level;
   ```

### ğŸ¯ Sink æ•°æ®åº“ç›‘æ§ (postgres-sgcc-sink:5443)

#### DWDå±‚ - æ•°æ®æ¸…æ´—ç»“æœ

1. **dwd_dim_equipment** - è®¾å¤‡ç»´åº¦è¡¨
   ```sql
   SELECT COUNT(*) as total_equipment, 
          COUNT(CASE WHEN is_active THEN 1 END) as active_equipment
   FROM dwd_dim_equipment;
   ```

2. **dwd_dim_customer** - å®¢æˆ·ç»´åº¦è¡¨
   ```sql
   SELECT customer_type, COUNT(*) as count 
   FROM dwd_dim_customer 
   WHERE is_active = true 
   GROUP BY customer_type;
   ```

3. **dwd_fact_power_consumption** - ç”¨ç”µäº‹å®è¡¨ â­ **æ ¸å¿ƒ**
   ```sql
   -- æŸ¥çœ‹æœ€æ–°å¤„ç†çš„ç”¨ç”µæ•°æ®
   SELECT customer_id, equipment_id, active_power, record_date, record_hour, etl_time
   FROM dwd_fact_power_consumption 
   ORDER BY etl_time DESC LIMIT 20;
   
   -- æŒ‰å°æ—¶ç»Ÿè®¡æ•°æ®é‡
   SELECT record_date, record_hour, COUNT(*) as record_count
   FROM dwd_fact_power_consumption 
   WHERE record_date = CURRENT_DATE
   GROUP BY record_date, record_hour
   ORDER BY record_hour DESC;
   ```

#### DWSå±‚ - æ±‡æ€»ç»Ÿè®¡ç»“æœ

1. **dws_equipment_hour_summary** - è®¾å¤‡å°æ—¶æ±‡æ€» â­ **é‡è¦**
   ```sql
   -- æŸ¥çœ‹è®¾å¤‡å¥åº·åº¦æ±‡æ€»
   SELECT equipment_id, stat_date, stat_hour, 
          avg_health_score, abnormal_count, total_records
   FROM dws_equipment_hour_summary 
   WHERE stat_date = CURRENT_DATE
   ORDER BY stat_hour DESC, avg_health_score ASC;
   ```

2. **dws_customer_hour_power** - å®¢æˆ·ç”¨ç”µå°æ—¶æ±‡æ€» â­ **é‡è¦**
   ```sql
   -- æŸ¥çœ‹å®¢æˆ·ç”¨ç”µæ±‡æ€»
   SELECT customer_id, stat_date, stat_hour,
          total_active_power, energy_consumption, anomaly_count
   FROM dws_customer_hour_power 
   WHERE stat_date = CURRENT_DATE
   ORDER BY stat_hour DESC, total_active_power DESC;
   ```

3. **dws_alert_hour_stats** - å‘Šè­¦å°æ—¶ç»Ÿè®¡
   ```sql
   -- æŸ¥çœ‹å‘Šè­¦ç»Ÿè®¡
   SELECT stat_date, stat_hour, 
          SUM(total_alerts) as total_alerts,
          SUM(critical_alerts) as critical_alerts,
          SUM(resolved_alerts) as resolved_alerts
   FROM dws_alert_hour_stats 
   WHERE stat_date = CURRENT_DATE
   GROUP BY stat_date, stat_hour
   ORDER BY stat_hour DESC;
   ```

#### ADSå±‚ - åº”ç”¨æ•°æ®æœåŠ¡

1. **ads_realtime_dashboard** - å®æ—¶å¤§å±æŒ‡æ ‡ â­ **å…³é”®**
   ```sql
   -- æŸ¥çœ‹å®æ—¶å¤§å±æ•°æ®
   SELECT metric_name, metric_value, metric_unit, metric_desc, update_time
   FROM ads_realtime_dashboard 
   ORDER BY update_time DESC;
   ```

2. **ads_equipment_health** - è®¾å¤‡å¥åº·åˆ†æ
   ```sql
   -- æŸ¥çœ‹è®¾å¤‡å¥åº·åˆ†æç»“æœ
   SELECT equipment_id, equipment_name, health_score, risk_level, 
          fault_count, recommendation, analysis_time
   FROM ads_equipment_health 
   WHERE risk_level IN ('HIGH', 'CRITICAL')
   ORDER BY health_score ASC;
   ```

## ğŸ”„ æ•°æ®æµç›‘æ§å»ºè®®

### å®æ—¶ç›‘æ§é¢‘ç‡
- **Sourceè¡¨**: æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡æ–°æ•°æ®
- **DWDå±‚**: æ¯1åˆ†é’Ÿæ£€æŸ¥å¤„ç†ç»“æœ
- **DWSå±‚**: æ¯5åˆ†é’Ÿæ£€æŸ¥æ±‡æ€»æ•°æ®
- **ADSå±‚**: æ¯10åˆ†é’Ÿæ£€æŸ¥åº”ç”¨æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡ç›‘æ§
1. **æ•°æ®å»¶è¿Ÿ**: å¯¹æ¯”sourceå’Œsinkçš„æœ€æ–°æ—¶é—´æˆ³
2. **æ•°æ®å®Œæ•´æ€§**: æ£€æŸ¥è®°å½•æ•°é‡æ˜¯å¦åŒ¹é…
3. **æ•°æ®è´¨é‡**: ç›‘æ§å¼‚å¸¸å€¼å’Œç©ºå€¼
4. **ç³»ç»Ÿå¥åº·**: ç›‘æ§Flinkä»»åŠ¡çŠ¶æ€

### å¿«é€Ÿè¿æ¥å‘½ä»¤
```bash
# è¿æ¥Sourceæ•°æ®åº“
psql -h localhost -p 5442 -U sgcc_user -d sgcc_source_db

# è¿æ¥Sinkæ•°æ®åº“
psql -h localhost -p 5443 -U sgcc_user -d sgcc_dw_db

# è¿›å…¥Flink SQL Client
docker exec -it sql-client-sgcc /opt/flink/bin/sql-client.sh

# æ‰§è¡Œå®Œæ•´SQLè„šæœ¬
docker exec -it sql-client-sgcc /opt/flink/bin/sql-client.sh -f /opt/sql/fluss_all_chain.sql

# æ‰§è¡ŒéªŒè¯è„šæœ¬
docker exec -it sql-client-sgcc /opt/flink/bin/sql-client.sh -f /opt/sql/verify_sgcc_system.sql
```

## ğŸ“ˆ æ•°æ®è§‚å¯Ÿé‡ç‚¹

### 1. æ•°æ®æµå¥åº·æ£€æŸ¥
- Sourceæ•°æ®æ˜¯å¦æŒç»­å¢é•¿
- CDCæ˜¯å¦æ­£å¸¸æ•è·å˜æ›´
- Flinkä»»åŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
- Sinkæ•°æ®æ˜¯å¦åŠæ—¶æ›´æ–°

### 2. ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
- è®¾å¤‡å¥åº·åº¦å˜åŒ–è¶‹åŠ¿
- ç”¨ç”µé‡å¼‚å¸¸æ£€æµ‹
- å‘Šè­¦å¤„ç†æ•ˆç‡
- ç³»ç»Ÿæ•´ä½“æ€§èƒ½

### 3. æ•…éšœæ’æŸ¥
- æ£€æŸ¥Flink Web UI: http://localhost:8091
- æŸ¥çœ‹å®¹å™¨æ—¥å¿—: `docker logs [container_name]`
- éªŒè¯æ•°æ®ä¸€è‡´æ€§
- ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ